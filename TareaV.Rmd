---
output: pdf_document
header-includes:
- \usepackage[spanish]{babel}\decimalpoint
- \usepackage{pdfpages}
---
\includepdf[pages=1]{portada_equipo_cuasiselecto.pdf}


**Esta tarea es para “crédito adicional”. Realice los siguientes ejercicios por equipo.**

\setcounter{page}{1}
\section{}
\textbf{1. Resuelva los ejercicios 12.2 y 12.3. Realice estos con ayuda de su labora- torista y entregue las soluciones a máquina, utilizando LaTeX. [2 horas, 2 puntos cada ejercicio]}\\
\subsection{(12.2)}
\textbf{Consider a discrete-time model where prices are completely unresponsive to unanticipated monetary shocks for one period and completely flexible thereafter. Suppose the $IS$ equation is $y=c-ar$ and that the condition for equilibrium in the money market is $m-p=b+hy-ki$. Here $y$, $m$, and $p$ are the logs of output, the money supply, and the price level; $r$ is the real interest rate; $i$ is the nominal interest rate; and $a$, $h$, and $k$ are positive parameters.}


\textbf{Assume that initially $m$ is constant at some level, which we normalize to zero, and that $y$ is constant at its flexible-price level, which we also normalize to zero. Now suppose that in some period–period 1 for simplicity–the monetary authority shifts unexpectedly to a policy of increasing $m$ by some amount $g>0$ each period.}
\subsubsection*{(a) What are $r$, $\pi^e$, $i$, and $p$ before the change in policy?}
\begin{align}
y&=c-ar\\
m-p&=b+hy-ki
\end{align}
Sustituyendo el valor inicial de $m$ y $y$ (ambos cero), obtenemos 
\begin{align}
0&=c-ar\nonumber\\
\iff r&=\frac{c}{a}
\end{align}
\begin{align}
0-p&=b+h(0)-ki\nonumber\\
\iff p&=ki-b
\end{align}
Supongamos que $\pi^e$ es igual a la inflación observada. En este caso, como $m=0$, entonces 
\begin{equation}
\pi^e=0
\end{equation}
Y por lo tanto, usando la identidad de Fisher, 
\begin{equation}
i=r+\pi^e=r=\frac{c}{a}
\end{equation}
Sustituyendo (6) en (4)
\begin{align}
p=k\frac{c}{a}-b:=p_0
\end{align}

\subsubsection*{(b) Once prices have fully adjusted, $\pi^e=g$. Use this fact to find $r$, $i$, and $p$ in period 2.}
$M$ no afecta $Y$ o $r$. Entonces, en el periodo 2,
\begin{align*}
r=\frac{c}{a}
\end{align*}
Tenemos que
$$\pi^e=g$$
Por lo tanto,
$$i=r+g=\frac{c}{a}+g$$
Como $m$ crece a tasa $g$, en el periodo 1, $m=g$, y en el periodo 2, $m=2g$. Sustituyendo en (2) y usando que $y=0$,
\begin{align*}
2g-p&=b+h(0)-ki=b-ki\\
\implies p&=2g-b+ki\\
&=2g-b+k\left(\frac{c}{a}+g\right)\\
&=g(2+k)-b+k\frac{c}{a}:=p_2
\end{align*}
\subsubsection*{(c) In period 1, what are $i$, $r$, $p$, and the expectation of inflation from period 1 to period 2, $\mathbb{E}_1[p_2]-p_1$?}
Como los precios no responden en absoluto a los shocks monetarios inesperados durante un período, el precio en el periodo 1 no cambia con respecto al precio inicial
\begin{align}
p=k\frac{c}{a}-b:=p_1
\end{align}
Recordemos que la inflación esperada es la inflación observada. Entonces tenemos simplemente que 
\begin{align}
\mathbb{E}_1[p_2]-p_1&=p_2-p_1\nonumber\\
&=g(2+k)-b+k\frac{c}{a}-\left(k\frac{c}{a}-b\right)\nonumber\\
&=g(2+k):=\pi_1^e
\end{align}
Entonces
\begin{align}
i_1=r_1+\pi_1^e=r+g(2+k)
\end{align}
Sustituyendo (1) en (2)
\begin{align}
m-p&=b+h(c-ar)-ki
\end{align}
Sustituyendo (8) y (10) en (11), y usando que $m_1=g$, obtenemos que 
\begin{align}
g-\left(k\frac{c}{a}-b\right)&=b+h(c-ar)-k(r+g(2+k))\nonumber\\
\iff g-k\frac{c}{a}&=h(c-ar)-k(r+g(2+k))\nonumber\\
\iff g-k\frac{c}{a}&=hc-kg(2+k)-(ha+k)r\nonumber\\
\iff r&=\frac{hc-kg(2+k)-g+k\frac{c}{a}}{ha+k}
\end{align}
Y finalmente tenemos que 
\begin{align}
i_1&=\frac{hc-kg(2+k)-g+k\frac{c}{a}}{ha+k}+g(2+k)\nonumber\\
&=\frac{hc-kg(2+k)-g+k\frac{c}{a}+g(2+k)(ha+k)}{ha+k}\nonumber\\
&=\frac{hc-g+k\frac{c}{a}+g(2+k)ha}{ha+k}
\end{align}

\subsubsection*{(d) What determines whether the short-run effect of the monetary expansion is to raise or lower the nominal interest rate?}
\begin{align}
i_1-i_0&=\frac{hc-g+k\frac{c}{a}+g(2+k)ha}{ha+k}-\frac{c}{a}\nonumber\\
&=\frac{ahc-ag+ak\frac{c}{a}+ag(2+k)ha-c(ha+k)}{a(ha+k)}\nonumber\\
&=\frac{ahc-ag+kc+g(2+k)ha^2-c(ha+k)}{a(ha+k)}\nonumber\\
&=\frac{g(2+k)ha^2-ag}{a(ha+k)}\nonumber\\
&=\frac{g(2+k)ha-g}{ha+k}>0\nonumber\\
\iff (2+k)ha&>1\nonumber\\
\end{align}

\cleardoublepage
\setcounter{equation}{0}
\subsection{(12.3)}
\textbf{Assume, as in Problem 12.2, that prices are completely unresponsive to unanticipated monetary shocks for one period and completely flexible thereafter. Assume also that $y=c-ar$ and $m-p=b+hy-ki$ hold each period. Suppose, however, that the money supply follows a random walk: $m_t=m_{t-1}+u_t$, where $u_t$ is a mean-zero, serially uncorrelated disturbance.} 

\subsubsection*{(a) Let $\mathbb{E}_t$ denote expectations as of period $t$. Explain why, for any $t$, $\mathbb{E}_t[\mathbb{E}_{t+1}[p_{t+2}]-p_{t+1}]=0$, and thus why $\mathbb{E}_tm_{t+1}-\mathbb{E}_tp_{t+1}=b+hy^n-kr^n$, where $y^n$ and $r^n$ are the flexible-price levels of $y$ and $r$.}
\begin{align}
\mathbb{E}_t[\mathbb{E}_{t+1}[p_{t+2}]-p_{t+1}]&=\mathbb{E}_t[\mathbb{E}_{t+1}[p_{t+2}]]-\mathbb{E}_t[p_{t+1}]\nonumber\\
&=\mathbb{E}_t[p_{t+2}]-\mathbb{E}_t[p_{t+1}]\nonumber\\
&=0
\end{align}
La ultima igualdad sigue de que como $\mathbb{E}_t(u_{t+1})=0$, no se espera, en $t$, que el precio cambie entre $t+1$ y $t+2$.

Por otro lado,
\begin{align}
\mathbb{E}_t(m_{t+1})-\mathbb{E}_t(p_{t+1})&=\mathbb{E}_t(m_{t+1}-p_{t+1})\nonumber\\
&=\mathbb{E}_t(b+hy_{t+1}-ki_{t+1})\nonumber\\
&=\mathbb{E}_t[b+hy_{t+1}-k(r_{t+1}+\pi_{t+1}^e)]\nonumber\\
&=\mathbb{E}_t[b+hy_{t+1}-kr_{t+1}-k(\mathbb{E}_{t+1}(p_{t+2})-p_{t+1})]\nonumber\\
&=b+h\mathbb{E}_t(y_{t+1})-k\mathbb{E}_t(r_{t+1})-k\mathbb{E}_t(\mathbb{E}_{t+1}(p_{t+2})-p_{t+1})\nonumber\\
&=b+h\mathbb{E}_t(y_{t+1})-k\mathbb{E}_t(r_{t+1})\nonumber\\
&=b+hy^n-kr^n
\end{align}

\subsubsection*{(b) Use the result in part (a) to solve for $y_t$, $p_t$, $i_t$, and $r_t$ in terms of $m_{t-1}$ and $u_t$.}
Tenemos que 
\begin{align}
\mathbb{E}_t(m_{t+1})&=\mathbb{E}_t(m_t+u_{t+1})\nonumber\\
&=m_t+\mathbb{E}_t(u_{t+1})\nonumber\\
&=m_t
\end{align}
Sustituyendo en (2) y reordenando
\begin{align}
\mathbb{E}_t(p_{t+1})&=m_t-b-hy^n+kr^n\nonumber\\
\iff \mathbb{E}_t(p_{t+1})-p_t&=m_t-p_t-b-hy^n+kr^n\nonumber\\
&=u_t
\end{align}
La ultima igualdad sigue porque el shock del periodo $t$ es la única fuente de variación de precios. Por lo tanto
\begin{align}
m_t&=m_{t-1}+u_t\nonumber\\
&=m_{t-1}+m_t-p_t-b-hy^n+kr^n\nonumber\\
\iff p_t&=m_{t-1}-b-hy^n+kr^n
\end{align}
Ahora
\begin{align}
m_t-p_t&=b+hy_t-ki_t\nonumber\\
\iff i_t&=\frac{b+hy_t-(m_t-p_t)}{k}
\end{align}
Sustituyendo (5)
\begin{align}
i_t&=\frac{b+hy_t-(m_t-m_{t-1}+b+hy^n-kr^n)}{k}\nonumber\\
&=\frac{h(y_t-y^n)-(m_t-m_{t-1})+kr^n}{k}\nonumber\\
&=\frac{h(y_t-y^n)-u_t+kr^n}{k}
\end{align}
Tenemos que 
\begin{align}
r_t&=i_t-\pi^e_t\nonumber\\
&=\frac{h(y_t-y^n)-u_t+kr^n}{k}-u_t
\end{align}
Sustituyendo en $y_t=c-ar_t$ obtenemos
\begin{align}
y_t&=c-a\frac{h(y_t-y^n)-u_t+kr^n}{k}+au_t\nonumber\\
\iff y_t\left(1+\frac{ah}{k}\right)&=c-a\frac{-hy^n-u_t+kr^n}{k}+au_t\nonumber\\ 
\iff y_t&=\frac{ck+a(hy^n+u_t-kr^n)+aku_t}{k+ah}\nonumber\\ 
&=\frac{ck+a(hy^n+(1+k)u_t-kr^n)}{k+ah}
\end{align}
Por lo que la tasa de interés real será
\begin{align}
y_t&=c-ar_t\nonumber\\
\iff r_t&=\frac{c-y_t}{a}\nonumber\\
&=\frac{c-\left(\frac{ck+a(hy^n+(1+k)u_t-kr^n)}{k+ah}\right)}{a}\nonumber\\
&=\frac{ck+cah-\left(ck+a(hy^n+(1+k)u_t-kr^n)\right)}{a(k+ah)}\nonumber\\
&=\frac{cah-a(hy^n+(1+k)u_t-kr^n)}{a(k+ah)}\nonumber\\
&=\frac{ch-(hy^n+(1+k)u_t-kr^n)}{k+ah}\nonumber\\
&=\frac{h(c-y^n)-(1+k)u_t+kr^n}{k+ah}
\end{align}
Y finalmente, la tasa de intereses nominal es
\begin{align}
i_t&=r_t+\pi^e_t\nonumber\\
&=r_t+u_t\nonumber\\
&=\frac{h(c-y^n)-(1+k)u_t+kr^n}{k+ah}+u_t\nonumber\\
&=\frac{h(c-y^n)-(1+k)u_t+kr^n+ku_t+ahu_t}{k+ah}\nonumber\\
&=\frac{h(c-y^n)-u_t+kr^n+ahu_t}{k+ah}\nonumber\\
&=\frac{h(c-y^n)+(ah-1)u_t+kr^n}{k+ah}\nonumber\\
&=\frac{h(c-y^n)+(ah-1)\pi^e_t+kr^n}{k+ah}
\end{align}

\subsubsection*{(c) Does the Fisher effect hold in this economy? That is, are changes in expected inflation reflected one-for-one in the nominal interest rate?}
No. Notemos que 
\begin{align}
\frac{\partial i_t}{\partial\pi^e_t}&=\frac{ah-1}{k+ah}=1\\
\iff k&=-1\nonumber
\end{align}
Lo cual nunca sucede. Por lo que cambios en inflación esperada no afectan uno a uno la tasa de interés nominal. 

\newpage
**2. Estudie la inflación y la política monetaria en México siguiendo estos pasos: [2 horas, 1.5 puntos cada inciso]. Por favor documente su trabajo para que se pueda replicar.**
```{r paquetes, warning= FALSE, message= FALSE, echo=FALSE}
# install.packages("xts")
# install.packages("tseries")
library(xts)
library(ggplot2)
library(ggfortify)
library(inegiR)
library(tseries)
library(stargazer)
```

**(a) Obtenga datos de las inflaciones ANUALES general y subyacente (del Índice Nacional de Precios al Consumidor) de México, por lo menos desde 1980, datos del desempleo a nivel nacional en México, y datos de la tasa de interés a corto plazo de México, todos a frecuencia MENSUAL, y grafíquelos individualmente.**

Se tomaron los datos de la inflación y del desempleo de las bases de datos del INEGI, y la tasa de interés a corto plazo del Banco de México.  Es importante señalar que los datos sobre desocupación antes de 2005 se obtuvieron de muestras urbanas de los 32 estados de la república, pues antes de este año la ENOE no se realizaba de forma general en el país. Por otro lado, para la tasa de interés a corto plazo se usaron los datos de CETES 28. 
```{r, warning=FALSE, echo=FALSE}
## Series de tiempo de variables requeridas
token_inegi <- "912ec65b-e82f-d58e-4efd-130da3484cf1"

# Datos
Inflacion_general <- inegi_series(583753, token_inegi)
Inflacion_subyacente <- inegi_series(628202, token_inegi)
Desempleo_tasa <- inegi_series(444884, token_inegi)
Desempleo_tasa_urbana <- inegi_series(123052, token_inegi)
tkn <- "8bd93af99a69ac4062f645fd43e0b517c5c88bb17750149a9fce21e47f8264af"
siebanxicor::setToken(tkn)
Tasa_CP <- siebanxicor::getSeriesData('SF43936', '1986-02-28','2022-03-01')


## Series de tiempo
Infgen_serie_m <- xts(Inflacion_general$values, Inflacion_general$date)
Infgen_serie <- xts(Inflacion_general$values, Inflacion_general$date)
Infgen_serie <- period.apply(Infgen_serie, 
                               INDEX = endpoints(Infgen_serie, on = "years", k = 1),
                               FUN = mean)
Infsub_serie_m <- xts(Inflacion_subyacente$values, Inflacion_subyacente$date)
Infsub_serie <- xts(Inflacion_subyacente$values, Inflacion_subyacente$date)
Infsub_serie <- period.apply(Infsub_serie, 
                               INDEX = endpoints(Infsub_serie, on = "years", k = 1),
                               FUN = mean)
Tasades_nuevo_serie <- xts(Desempleo_tasa$values, Desempleo_tasa$date)
Tasades_antiguo_serie <- xts(Desempleo_tasa_urbana$values, Desempleo_tasa_urbana$date)
Tasades_antiguo_serie <- Tasades_antiguo_serie['1996/2004']
Tasades_serie <- c(Tasades_antiguo_serie, Tasades_nuevo_serie)
Tasades_serie <- period.apply(Tasades_serie, 
                               INDEX = endpoints(Tasades_serie, on = "months", k = 1),
                               FUN = mean)
TasaCP_serie <- xts(Tasa_CP$SF43936$value, Tasa_CP$SF43936$date)
TasaCP_serie <- period.apply(TasaCP_serie, 
                               INDEX = endpoints(TasaCP_serie, on = "months", k = 1),
                               FUN = mean)
```

```{r fig.cap="Serie de tiempo de inflación (1970-2022)", echo=FALSE}
## Gráficos
autoplot(Infgen_serie, ts.colour = 'red', xlab = "Año", ylab = "Inflación total")
```

```{r fig.cap="Serie de tiempo de inflación subyacente (1982-2022)", echo=FALSE}
## Gráficos
autoplot(Infsub_serie, ts.colour = 'blue', xlab = "Año", ylab = "Inflación subyacente")
```

```{r fig.cap="Tasa de desempleo (1996-2022)", echo=FALSE}
## Gráficos
autoplot(Tasades_serie, ts.colour = 'salmon', xlab = "Año", ylab = "Tasa de desempleo")
```

```{r fig.cap="Serie de tiempo de tasa de interés a corto plazo (1986-2022)", echo=FALSE}
## Gráficos
autoplot(TasaCP_serie, ts.colour = 'orange', xlab = "Año", ylab = "Tasa de interés de corto plazo")
```

\newpage
**(b) Produzca una tabla de estadísticas descriptivas de estos datos, incluyendo medias, varianzas y autocorrelaciones, para todo el periodo para el que tenga datos y para dos subperiodos, antes y después del año 1999.**
```{r, echo=FALSE}
## Inflación general
### Total
Obs_Infgen <- length(Infgen_serie)
Media_Infgen <- mean(Infgen_serie)
Var_Infgen <- var(Infgen_serie)
Min_Infgen <- min(Infgen_serie)
Max_Infgen <- max(Infgen_serie)
Rango_Infgen <- Max_Infgen-Min_Infgen
Autocorr_Infgen <- acf(Infgen_serie, lag=2, pl=FALSE)
Total_Infgen <- data.frame("Obs" = Obs_Infgen,
                           "Media" = Media_Infgen,
                           "Varianza" = Var_Infgen,
                           "Min" = Min_Infgen,
                           "Max"= Max_Infgen,
                           "Rango" = Rango_Infgen,
                           "Autocorr"=
                             t(as.matrix(Autocorr_Infgen[[1]])))
### Anterior a 1999
Infgen_antig_serie <- Infgen_serie['1950/1998']
Obs_Infgen_antig <- length(Infgen_antig_serie)
Media_Infgen_antig <- mean(Infgen_antig_serie)
Var_Infgen_antig <- var(Infgen_antig_serie)
Min_Infgen_antig <- min(Infgen_antig_serie)
Max_Infgen_antig <- max(Infgen_antig_serie)
Rango_Infgen_antig <- Max_Infgen_antig-Min_Infgen_antig
Autocorr_Infgen_antig <- acf(Infgen_antig_serie, lag=2, pl=FALSE)
Total_Infgen_antig <- data.frame("Obs" = Obs_Infgen_antig,
                           "Media" = Media_Infgen_antig,
                           "Varianza" = Var_Infgen_antig,
                           "Min" = Min_Infgen_antig,
                           "Max"= Max_Infgen_antig,
                           "Rango" = Rango_Infgen_antig,
                           "Autocorr"=
                             t(as.matrix(Autocorr_Infgen_antig[[1]])))

### Posterior a 1999
Infgen_nuev_serie <- Infgen_serie['1999/2030']
Obs_Infgen_nuev <- length(Infgen_nuev_serie)
Media_Infgen_nuev <- mean(Infgen_nuev_serie)
Var_Infgen_nuev <- var(Infgen_nuev_serie)
Min_Infgen_nuev <- min(Infgen_nuev_serie)
Max_Infgen_nuev <- max(Infgen_nuev_serie)
Rango_Infgen_nuev <- Max_Infgen_nuev-Min_Infgen_nuev
Autocorr_Infgen_nuev <- acf(Infgen_nuev_serie, lag=2, pl=FALSE)
Total_Infgen_nuev <- data.frame("Obs" = Obs_Infgen_nuev,
                           "Media" = Media_Infgen_nuev,
                           "Varianza" = Var_Infgen_nuev,
                           "Min" = Min_Infgen_nuev,
                           "Max"= Max_Infgen_nuev,
                           "Rango" = Rango_Infgen_nuev,
                           "Autocorr"=
                             t(as.matrix(Autocorr_Infgen_nuev[[1]])))


## Inflación subyacente
### Total
Obs_Infsub <- length(Infsub_serie)
Media_Infsub <- mean(Infsub_serie)
Var_Infsub <- var(Infsub_serie)
Min_Infsub <- min(Infsub_serie)
Max_Infsub <- max(Infsub_serie)
Rango_Infsub <- Max_Infsub-Min_Infsub
Autocorr_Infsub <- acf(Infsub_serie, lag=2, pl=FALSE)
Total_Infsub <- data.frame("Obs" = Obs_Infsub,
                           "Media" = Media_Infsub,
                           "Varianza" = Var_Infsub,
                           "Min" = Min_Infsub,
                           "Max"= Max_Infsub,
                           "Rango" = Rango_Infsub,
                           "Autocorr"=
                             t(as.matrix(Autocorr_Infsub[[1]])))
### Anterior a 1999
Infsub_antig_serie <- Infsub_serie['1950/1998']
Obs_Infsub_antig <- length(Infsub_antig_serie)
Media_Infsub_antig <- mean(Infsub_antig_serie)
Var_Infsub_antig <- var(Infsub_antig_serie)
Min_Infsub_antig <- min(Infsub_antig_serie)
Max_Infsub_antig <- max(Infsub_antig_serie)
Rango_Infsub_antig <- Max_Infsub_antig-Min_Infsub_antig
Autocorr_Infsub_antig <- acf(Infsub_antig_serie, lag=2, pl=FALSE)
Total_Infsub_antig <- data.frame("Obs" = Obs_Infsub_antig,
                           "Media" = Media_Infsub_antig,
                           "Varianza" = Var_Infsub_antig,
                           "Min" = Min_Infsub_antig,
                           "Max"= Max_Infsub_antig,
                           "Rango" = Rango_Infsub_antig,
                           "Autocorr"=
                             t(as.matrix(Autocorr_Infsub_antig[[1]])))

### Posterior a 1999
Infsub_nuev_serie <- Infsub_serie['1999/2030']
Obs_Infsub_nuev <- length(Infsub_nuev_serie)
Media_Infsub_nuev <- mean(Infsub_nuev_serie)
Var_Infsub_nuev <- var(Infsub_nuev_serie)
Min_Infsub_nuev <- min(Infsub_nuev_serie)
Max_Infsub_nuev <- max(Infsub_nuev_serie)
Rango_Infsub_nuev <- Max_Infsub_nuev-Min_Infsub_nuev
Autocorr_Infsub_nuev <- acf(Infsub_nuev_serie, lag=2, pl=FALSE)
Total_Infsub_nuev <- data.frame("Obs" = Obs_Infsub_nuev,
                           "Media" = Media_Infsub_nuev,
                           "Varianza" = Var_Infsub_nuev,
                           "Min" = Min_Infsub_nuev,
                           "Max"= Max_Infsub_nuev,
                           "Rango" = Rango_Infsub_nuev,
                           "Autocorr"=
                             t(as.matrix(Autocorr_Infsub_nuev[[1]])))


## Tasa de desempleo
### Total
Obs_Tasades <- length(Tasades_serie)
Media_Tasades <- mean(Tasades_serie)
Var_Tasades <- var(Tasades_serie)
Min_Tasades <- min(Tasades_serie)
Max_Tasades <- max(Tasades_serie)
Rango_Tasades <- Max_Tasades-Min_Tasades
Autocorr_Tasades <- acf(Tasades_serie, lag=2, pl=FALSE)
Total_Tasades <- data.frame("Obs" = Obs_Tasades,
                           "Media" = Media_Tasades,
                           "Varianza" = Var_Tasades,
                           "Min" = Min_Tasades,
                           "Max"= Max_Tasades,
                           "Rango" = Rango_Tasades,
                           "Autocorr"=
                             t(as.matrix(Autocorr_Tasades[[1]])))
### Anterior a 1999
Tasades_antig_serie <- Tasades_serie['1950/1998']
Obs_Tasades_antig <- length(Tasades_antig_serie)
Media_Tasades_antig <- mean(Tasades_antig_serie)
Var_Tasades_antig <- var(Tasades_antig_serie)
Min_Tasades_antig <- min(Tasades_antig_serie)
Max_Tasades_antig <- max(Tasades_antig_serie)
Rango_Tasades_antig <- Max_Tasades_antig-Min_Tasades_antig
Autocorr_Tasades_antig <- acf(Tasades_antig_serie, lag=2, pl=FALSE)
Total_Tasades_antig <- data.frame("Obs" = Obs_Tasades_antig,
                           "Media" = Media_Tasades_antig,
                           "Varianza" = Var_Tasades_antig,
                           "Min" = Min_Tasades_antig,
                           "Max"= Max_Tasades_antig,
                           "Rango" = Rango_Tasades_antig,
                           "Autocorr"=
                             t(as.matrix(Autocorr_Tasades_antig[[1]])))

### Posterior a 1999
Tasades_nuev_serie <- Tasades_serie['1999/2030']
Obs_Tasades_nuev <- length(Tasades_nuev_serie)
Media_Tasades_nuev <- mean(Tasades_nuev_serie)
Var_Tasades_nuev <- var(Tasades_nuev_serie)
Min_Tasades_nuev <- min(Tasades_nuev_serie)
Max_Tasades_nuev <- max(Tasades_nuev_serie)
Rango_Tasades_nuev <- Max_Tasades_nuev-Min_Tasades_nuev
Autocorr_Tasades_nuev <- acf(Tasades_nuev_serie, lag=2, pl=FALSE)
Total_Tasades_nuev <- data.frame("Obs" = Obs_Tasades_nuev,
                           "Media" = Media_Tasades_nuev,
                           "Varianza" = Var_Tasades_nuev,
                           "Min" = Min_Tasades_nuev,
                           "Max"= Max_Tasades_nuev,
                           "Rango" = Rango_Tasades_nuev,
                           "Autocorr"=
                             t(as.matrix(Autocorr_Tasades_nuev[[1]])))



## Tasa a corto plazo
### Total
Obs_TasaCP <- length(TasaCP_serie)
Media_TasaCP <- mean(TasaCP_serie,  na.rm=TRUE)
Var_TasaCP <- var(TasaCP_serie,  na.rm=TRUE)
Min_TasaCP <- min(TasaCP_serie,  na.rm=TRUE)
Max_TasaCP <- max(TasaCP_serie,  na.rm=TRUE)
Rango_TasaCP <- Max_TasaCP-Min_TasaCP
Autocorr_TasaCP <- acf(TasaCP_serie, lag=2, pl=FALSE, na.action=na.pass)
Total_TasaCP <- data.frame("Obs" = Obs_TasaCP,
                           "Media" = Media_TasaCP,
                           "Varianza" = Var_TasaCP,
                           "Min" = Min_TasaCP,
                           "Max"= Max_TasaCP,
                           "Rango" = Rango_TasaCP,
                           "Autocorr"=
                             t(as.matrix(Autocorr_TasaCP[[1]])))
### Anterior a 1999
TasaCP_antig_serie <- TasaCP_serie['1950/1998']
Obs_TasaCP_antig <- length(TasaCP_antig_serie)
Media_TasaCP_antig <- mean(TasaCP_antig_serie,  na.rm=TRUE)
Var_TasaCP_antig <- var(TasaCP_antig_serie,  na.rm=TRUE)
Min_TasaCP_antig <- min(TasaCP_antig_serie,  na.rm=TRUE)
Max_TasaCP_antig <- max(TasaCP_antig_serie,  na.rm=TRUE)
Rango_TasaCP_antig <- Max_TasaCP_antig-Min_TasaCP_antig
Autocorr_TasaCP_antig <- acf(TasaCP_antig_serie, lag=2, pl=FALSE, na.action=na.pass)
Total_TasaCP_antig <- data.frame("Obs" = Obs_TasaCP_antig,
                           "Media" = Media_TasaCP_antig,
                           "Varianza" = Var_TasaCP_antig,
                           "Min" = Min_TasaCP_antig,
                           "Max"= Max_TasaCP_antig,
                           "Rango" = Rango_TasaCP_antig,
                           "Autocorr"=
                             t(as.matrix(Autocorr_TasaCP_antig[[1]])))

### Posterior a 1999
TasaCP_nuev_serie <- TasaCP_serie['1999/2030']
Obs_TasaCP_nuev <- length(TasaCP_nuev_serie)
Media_TasaCP_nuev <- mean(TasaCP_nuev_serie)
Var_TasaCP_nuev <- var(TasaCP_nuev_serie)
Min_TasaCP_nuev <- min(TasaCP_nuev_serie)
Max_TasaCP_nuev <- max(TasaCP_nuev_serie)
Rango_TasaCP_nuev <- Max_TasaCP_nuev-Min_TasaCP_nuev
Autocorr_TasaCP_nuev <- acf(TasaCP_nuev_serie, lag=2, pl=FALSE, na.action=na.pass)
Total_TasaCP_nuev <- data.frame("Obs" = Obs_TasaCP_nuev,
                           "Media" = Media_TasaCP_nuev,
                           "Varianza" = Var_TasaCP_nuev,
                           "Min" = Min_TasaCP_nuev,
                           "Max"= Max_TasaCP_nuev,
                           "Rango" = Rango_TasaCP_nuev,
                           "Autocorr"=
                             t(as.matrix(Autocorr_TasaCP_nuev[[1]])))

Estadisticos <- rbind(Total_Infgen, Total_Infgen_antig, Total_Infgen_nuev,
                      Total_Infsub, Total_Infsub_antig, Total_Infgen_nuev,
                      Total_Tasades, Total_Tasades_antig, Total_Tasades_nuev,
                      Total_TasaCP, Total_TasaCP_antig, Total_TasaCP_nuev)
Estadisticos <- cbind("Datos"=c("Inflación", "Inflación -1999", "Inflación 1999-",
                        "Inflación sub", "Inflación sub -1999", "Inflación sub 1999-",
                        "Tasa desempleo", "Tasa desempleo -1999", "Tasa desempleo 1999-",
                        "Tasa CP", "Tasa CP -1999", "Tasa CP 1999-"), 
                      Estadisticos)
# knitr::kable(Estadisticos, digits=3, caption = 'Estadísticos')

```

Table: Estadísticos

|Datos                | Obs|  Media| Varianza|   Min|     Max|   Rango| Autocorr.1| Autocorr.2| Autocorr.3|
|:--------------------|---:|------:|--------:|-----:|-------:|-------:|----------:|----------:|----------:|
|Inflación            |  53| 21.870|  888.845| 2.724| 128.892| 126.168|          1|      0.776|      0.543|
|Inflación -1999      |  29| 35.662| 1208.891| 4.939| 128.892| 123.953|          1|      0.683|      0.358|
|Inflación 1999-      |  24|  5.205|    8.249| 2.724|  16.671|  13.947|          1|      0.402|      0.103|
|Inflación sub        |  41|  1.511|    3.912| 0.200|   8.230|   8.030|          1|      0.777|      0.566|
|Inflación sub -1999  |  17|  3.106|    5.102| 0.619|   8.230|   7.611|          1|      0.630|      0.279|
|Inflación sub 1999-  |  24|  5.205|    8.249| 2.724|  16.671|  13.947|          1|      0.402|      0.103|
|Tasa desempleo       | 306|  4.271|    0.661| 2.760|   7.300|   4.540|          1|      0.876|      0.825|
|Tasa desempleo -1999 |  27|  5.193|    0.717| 3.700|   7.300|   3.600|          1|      0.596|      0.392|
|Tasa desempleo 1999- | 279|  4.182|    0.568| 2.760|   6.280|   3.520|          1|      0.900|      0.864|
|Tasa CP              | 432| 18.651|  576.155| 2.673| 157.070| 154.397|          1|      0.975|      0.931|
|Tasa CP -1999        | 154| 39.650|  907.709| 9.450| 157.070| 147.620|          1|      0.966|      0.894|
|Tasa CP 1999-        | 278|  7.095|   18.718| 2.673|  32.125|  29.452|          1|      0.926|      0.859|

**(c) Una “regla de Taylor” es una función que define a la tasa de interés de corto plazo del periodo t en términos de la distancia entre la inflación y su objetivo y del desempleo y su objetivo en el periodo t-1 (y de una constante). Asuma que el objetivo de inflación es 3% y tome el objetivo de desempleo como 3% y estime los coeficientes de una regla de Taylor para México para tres grupos de datos: el periodo completo para el que tenga datos, y los dos sub-periodos definidos anteriormente. Estime las regresiones con la inflación general y con la subyacente. (John Taylor famosamente empezó por decir que era sólamente una relación empírica – positiva –, y ya que se hizo famosa su regla, empezó a decir que debería usarse como regla para la determinación de la tasa de interés de política – normativa.)**

Para la solución de este problema usaremos la regla de Taylor general
$$
i_t=\alpha+\beta_1(\pi_t-\pi^*)+\beta_2(u_t-u^*)=\alpha+\beta_1(\pi_t-3)+\beta_2(u_t-3).
$$

Como solo tenemos datos del desempleo a partir de octubre de 1996, usaremos esta fecha como la inicial. Además, la tasa de interés a corto plazo sólo se tiene hasta febrero de 2022, por lo que esta será nuestra fecha final.

```{r, echo=FALSE}
f <- function(x){x-3}

TasaCP <- TasaCP_serie["1996-10-01/2022-02-24"]
TasaCP_pre1999 <- TasaCP_serie["1996-10-01/1998"]
TasaCP_pos1999 <- TasaCP_serie["1999/2022-02-24"]
Inflación_3 <- f(Infgen_serie_m["1996-10-01/2022-02-24"])
Desempleo_3 <- f(Tasades_serie["1996-10-01/2022-02-24"])
Inflacion_pre1999_3 <- f(Infgen_serie_m["1996-10-01/1998"])
Desempleo_pre1999_3 <-  f(Tasades_serie["1996-10-01/1998"])
Inflacion_pos1999_3 <- f(Infgen_serie_m["1999/2022-02-24"])
Desempleo_pos1999_3 <-  f(Tasades_serie["1999/2022-02-24"])
Inflaciónsub_3 <- f(Infsub_serie_m["1996-10-01/2022-02-24"])
Inflacionsub_pre1999_3 <- f(Infsub_serie_m["1996-10-01/1998"])
Inflacionsub_pos1999_3 <- f(Infsub_serie_m["1999/2022-02-24"])


M1_Infgen <- lm(TasaCP~ 
                  Inflación_3+ 
                  Desempleo_3)
M2_Infgen_pre1999 <- lm(TasaCP_pre1999 ~ 
                          Inflacion_pre1999_3 + 
                  Desempleo_pre1999_3)
M3_Infgen_pos1999 <- lm(TasaCP_pos1999 ~ 
                          Inflacion_pos1999_3 + 
                  Desempleo_pos1999_3)
M4_Infsub <- lm(TasaCP~ 
                  Inflaciónsub_3+ 
                  Desempleo_3)
M5_Infsub_pre1999 <- lm(TasaCP_pre1999 ~ 
                          Inflacionsub_pre1999_3+ 
                  Desempleo_pre1999_3)
M6_Infsub_pos1999 <- lm(TasaCP_pos1999~ 
                         Inflacionsub_pos1999_3+ 
                 Desempleo_pos1999_3)


# stargazer(M1_Infgen, M2_Infgen_pre1999, M3_Infgen_pos1999, M4_Infsub,
#           M5_Infsub_pre1999, M6_Infsub_pos1999, title="Regresiones", align=TRUE)


```


```{r, results='asis', echo=FALSE}
stargazer(M1_Infgen, M2_Infgen_pre1999, M3_Infgen_pos1999, 
          title="Regresiones con inflación", header=FALSE, type='latex')
```

```{r, results='asis', echo=FALSE}
stargazer(M4_Infsub, M5_Infsub_pre1999, M6_Infsub_pos1999,
          title="Regresiones con inflación subyacente", header=FALSE, type='latex')
```

\newpage 

**(d) Interprete los resultados de las regresiones, en general, y a la luz de la adopción en México de un régimen de objetivos de inflación en el año 1999. (En realidad, el objetivo de inflación, fue 3% solamente a partir de 2003 cuando se volvió "la meta permanente".)**

En primer lugar, cabe destacar que, según el cuadro de estadísticos realizado, todas las variables salvo la inflación subyacente tienen mayor variabilidad en el período previo a 1999 (en particular, la inflación, en donde la variación llega a ser de cuatro dígitos;  la tasa de interés de corto plazo, de dos dígitos). Por otro lado, la inflación subyacente incrementa levemente su varianza de un dígito, por lo que podemos concluir que los choques en el período previo a 1999 estaban relacionados con los energéticos y los alimentos sin elaborar.

La tendencia anterior también se observa en la media de la inflación y de la tasa de corto plazo, pues previo a 1999 es de dos dígitos y posteriormente es solamente de uno.

Cabe destacar también que en todos los modelos se tienen más datos del período posterior a 1999, por lo que los dos modelos que sólo toman el conjunto total de datos están sesgados hacía lo que aconteció después de esta fecha.

Ahora bien, en líneas generales podemos observar que en 5 de los 6 modelos calculados los coeficientes de las variables elegidas en la regla de Taylor (a saber, los respectivos $\alpha, \beta_1, \beta_2$) son individualmente significantes para un nivel de confianza de hasta 99.99%. Esto ocurre de igual modo con la significancia conjunta (que evaluamos a partir del estadístico F) para los mismos modelos. El único que no es significante es el modelo donde la inflación se toma como la subyacente en el período previo a 1999, por lo que no lo analizaremos (aún más, el modelo solamente explica al rededor del 5.6% de la variación de la tasa de interés a CP, por lo que no parece ser un buen modelo para relacionar la inflación y el desempleo con las decisiones de política monetaria).


Por otro lado, observamos que en todos los modelos el sentido de la respuesta de la política monetaria es el esperado: si crece la inflación, para enfriar la economía se elige aumentar la tasa de interés de corto plazo; si aumenta el desempleo, la tasa de corto plazo se reduce para alentar la actividad económica. 


Respecto a los modelos donde uno de los regresores es la diferencia entre la inflación total y la objetivo, podemos observar que la constante disminuye del período previo a 1999 al período siguiente. Es decir, la política monetaria, si la inflación y el desempleo estuvieran en su objetivo de 3%, buscaba ser más restrictiva y mantener las tasas hasta 2.5 veces más altas antes. Esto puede explicarse sea porque el objetivo de inflación no era el señalado, sino que probablemente era más alto, sea porque el objetivo de desempleo era distinto. 

Por otro lado, podemos observar que el coeficiente $\beta_2$ del desempleo antes de 1999 es casi 5 veces mayor que el de la inflación en este período, y 3 veces mayor que el correspondiente en el período posterior a 1999. Esto significa que la política monetaria era mucho más aversa al desempleo que a la inflación en el período previo a 1999. En cambio, el coeficiente $\beta_1$ ha cambiado poco entre los dos períodos, si bien podríamos decir que se responde a desviaciones de la inflación de su objetivo un poco más.


Finalmente, podemos observar de la $R^2$ que después de 1999 el 80% de las variación en la tasa de interés a corto plazo se puede explicar desde la Regla de Taylor propuesta, mientras que esta figura es tan solo de 34% para el período previo a 1999. Esto refleja que el Banco Central se ha mantenido en su compromiso pues casi la totalidad de los cambios en la tasa a corto plazo obedecen a los objetivos de inflación y desempleo (y probablemente la diferencia se debe a las coyunturas que llevan a mover alguno de los dos objetivos).


Si nos centramos ahora en los modelos donde la regla de Taylor contempla la inflación subyacente, encontramos primero que la constante $\alpha$ aumenta en 10 puntos del período previo a 1999 al período posterior. Recordamos que en general se toman los precios más estables, con menor volatilidad, cambios estacionales y dependencia de decisiones administrativas. Es decir, los cambios en este nivel de inflación están relacionados más bien con cambios estructurales y no con cambios del ciclo económico a los cuales hay que responder y suavizar; podemos pensarla como un reflejo de lo que sucede a mediano plazo. Así, podemos observar que la política monetaria, comparando con los modelos de inflación, cambia su aversión a la inflación entre los dos períodos mencionados: antes de 1999 tenía una política monetaria menos restrictiva en el corto plazo que después de este año, pues reaccionaba más si la inflación de corto plazo estaba en su tasa objetivo; por su parte, antes de 1999 había una política monetaria más laxa si la inflación de mediano plazo estaba en su objetivo que después de tal año. Así, la regla de Taylor refleja un cambio en la visión para estabilizar la economía más allá de la coyuntura inmediata (aunque cabe señalar que en ambos casos se es más restrictivo en el mediano plazo que en el mediano plazo).

El argumento anterior se refleja en que el coeficiente sobre el regresor que tiene a la inflación subyacente es hasta 9 veces mayor que el coeficiente correspondiente al hacer una regresión sobre la inflación (todo esto en los modelos significantes, aunque el resultado se mantiene en el modelo que dejamos de lado, si bien en magnitud menor).


Por último, cabe señalar que después de 1999 la variación de la tasa de interés de corto plazo se explica en un 63% al tomar a la inflación de mediano plazo, pero sólo en un 5% en el período previo. Esto continua en línea con los argumentos ya expuestos: que no solamente se decidió hacer política monetaria con objetivos de inflación, sino que además se integró el horizonte de mediano plazo en la toma de decisiones.




\newpage
**3) Estudie el efecto de cambios en la tasa de interés de México sobre la curva de tasas de interés: [2 horas, 1.5 puntos cada inciso]. Por favor documente su trabajo para que se pueda replicar.**

**(a) Obtenga datos de la tasa de interés de referencia del Banco de México, y datos de las tasas de interés en pesos a distintos plazos, 28 días, 1 año, 2 años, 5 años, 10 años. Nótese que están disponibles en distintos periodos cada una.**

Se utilizaron las siguientes series del SIE de Banxico.

```{r, echo=FALSE}
Tasa <- c('Tasa objetivo', 'CETES 28 días', 'CETES 1 año', 
           'Bonos 3 años', 'Bonos 5 años',
           'Bonos 10 años')
Serie <- c('SF61745', 'SF43936', 'SF43945', 'SF43883',
           'SF43886', 'SF44071')
tipificacion <- data.frame(Tasa, Serie)
knitr::kable(tipificacion, caption = 'Tasa de interés')
```

Se presenta parte del conjunto de datos que se construyó.

```{r, echo=FALSE, message=FALSE}
# Abrir sesión en API banxico
tkn <- "8bd93af99a69ac4062f645fd43e0b517c5c88bb17750149a9fce21e47f8264af"
siebanxicor::setToken(tkn)
series <- siebanxicor::getSeriesData(Serie, '2009-07-01','2022-03-01')
j = 1
for (i in match(names(series),Serie)) {
  a <- data.frame(series[[j]])
  a[,1] <- format(a[,1], '%m-%Y')
  a <- dplyr::ungroup(
    dplyr::summarise(
      dplyr::group_by(a,date),
      tasa = mean(value, na.rm =T)
    )
  )
  if (j == 1) {
    ds <- a
    colnames(ds) <- c('date' , Tasa[i])
    j = j + 1
    next
  }
  ds <- dplyr::full_join(ds, a, by = 'date')
  j = j + 1
  colnames(ds)[j] <- Tasa[i]
}
ds <- dplyr::select(ds, c('date', Tasa))
ds[,1] <- as.Date(paste(rep('01-',dim(ds)[1]), 
                           as.data.frame(ds)[,1], sep = ''), 
                     '%d-%m-%Y')
ds <- dplyr::arrange(ds, date)
objetivo <- ds[,c(1,2)]

#summary(ds)
#var(ds, na.rm = T)
```

Table: Tasas de interés I

|date       | Tasa objetivo| CETES 28 días| CETES 1 año| Bonos 3 años| Bonos 5 años| Bonos 10 años|
|:----------|-------------:|-------------:|-----------:|------------:|------------:|-------------:|
|2021-10-01 |      4.750000|        4.8400|      6.2225|         6.68|         7.43|          7.61|
|2021-11-01 |      4.908333|        5.0475|      6.4750|         7.05|         7.60|          7.54|
|2021-12-01 |      5.241936|        5.2880|      6.6780|         7.19|         7.34|          7.57|
|2022-01-01 |      5.500000|        5.5250|      6.9825|         7.61|         7.69|              |
|2022-02-01 |      5.821429|        5.8700|      7.1625|         7.57|         7.76|          7.68|


**(b) Produzca una tabla de estadísticas descriptivas de estos datos, in- cluyendo medias y varianzas, para todo el periodo para el que tenga datos de cada variable.**

Se presentan las tablas de estadísticos con la media y varianza incluidas. 

Table: Estadísticas descriptivas I

|     date          |Tasa objetivo |CETES 28 días | CETES 1 año  |
|:------------------|:-------------|:-------------|:-------------|
|Min.   :2009-07-01 |Min.   :3.000 |Min.   :2.672 |Min.   :3.010 |
|1st Qu.:2012-09-01 |1st Qu.:4.000 |1st Qu.:3.845 |1st Qu.:4.196 |
|Median :2015-11-01 |Median :4.500 |Median :4.329 |Median :4.760 |
|Mean   :2015-10-31 |Mean   :5.000 |Mean   :4.883 |Mean   :5.280 |
|3rd Qu.:2019-01-01 |3rd Qu.:6.107 |3rd Qu.:6.066 |3rd Qu.:6.737 |
|Max.   :2022-03-01 |Max.   :8.250 |Max.   :8.250 |Max.   :8.670 |
|                   |Var    :2.522 |Var    :3.104 |Var    :2.946 |

Table: Estadísticas descriptivas II

|     date          | Bonos 3 años | Bonos 5 años |Bonos 10 años |
|:------------------|:-------------|:-------------|:-------------|
|Min.   :2009-07-01 |Min.   :4.000 |Min.   :4.140 |Min.   :4.640 |
|1st Qu.:2012-09-01 |1st Qu.:4.808 |1st Qu.:5.120 |1st Qu.:6.005 |
|Median :2015-11-01 |Median :5.395 |Median :5.940 |Median :6.465 |
|Mean   :2015-10-31 |Mean   :5.776 |Mean   :6.144 |Mean   :6.664 |
|3rd Qu.:2019-01-01 |3rd Qu.:6.720 |3rd Qu.:7.173 |3rd Qu.:7.497 |
|Max.   :2022-03-01 |Max.   :8.870 |Max.   :8.795 |Max.   :9.110 |
|                   |Var    :1.621 |Var    :1.393 |Var    :0.824 |

Notemos que la varianza disminuye de acuerdo al plazo para los bonos del gobierno. Sucede de igual forma para la TIIE de 28 día y de 91 días. De igual forma, las tasas de interés del gobierno aumentan su media de acuerdo al plazo, a mayor plazo un mayor rendimiento. 

**(c) Calcule una regresión de los CAMBIOS en cada una de las tasas, excepto la del Banco de México, en función de los CAMBIOS en la tasa de interés del Banco de México. Produzca una tabla comparando los resultados de las distintas regresiones.**

Realizamos la siguiente regresión lineal. 

$$
\Delta \text{Tasa}_{plazo} = 
\alpha+
\beta_1 \Delta \text{Tasa de objetivo}+
u
$$

```{r, echo=FALSE}
regresion <- function(datos = ds, 
                      agrupacion = NA, 
                      var.agrupacion = NA, 
                      dependiente = 1, 
                      independiente = 2, 
                      nombre.regresion = 'reg.1'){
  if (is.na(agrupacion) == F) {
    if (is.na(var.agrupacion) == T | is.numeric(var.agrupacion) == F) {
      stop('No especificaste el número de columna
           para agrupar ó la variable -var.agrupacion- no es numérica')
    }
    datos <- datos[datos[,var.agrupacion] == agrupacion,]
  }
  n <- dim(datos)[1]
  X <-  matrix(cbind(rep(1,n), as.matrix(datos[,independiente])), 
               ncol = (length(independiente) + 1), nrow = n)
  colnames(X) <-  c('alpha', colnames(datos)[independiente])
  Y <-  as.matrix(datos[,dependiente[1]], ncol = 1)
  colnames(Y) <- nombre.regresion
  b.hat <- solve(t(X) %*% X) %*% t(X) %*% Y
  sigma.hat <- t(Y - X %*% b.hat) %*% (Y - X %*% b.hat) * (1/(n-dim(X)[2]))
  xtx <- solve(t(X) %*% X)
  s.e <- c()
  for (i in 1:(length(independiente)+1)) {
    s.e[i] <- sqrt(sigma.hat)*sqrt(xtx[i,i])
  }
  R <- c(sum((X %*% b.hat - mean(Y))^2)/sum((Y - mean(Y))^2),NA)
  b.hat <- round(rbind(cbind(b.hat, s.e),R),3)
  t(b.hat)
}

# reg uno
nombres <- names(ds)[3:7]
j = 1
for (k in c(3:7)) {
  modelo.1 <- ds[,c(2,k)]
  
  for (i in 1:dim(modelo.1)[2]) {
    modelo.1 <- modelo.1[is.na(modelo.1[,i]) != TRUE,]
  }
  
  ds.nolag <- matrix(unlist(modelo.1[1:(dim(modelo.1)[1]-1),]),
                     ncol = dim(modelo.1)[2])
  ds.lag <- matrix(unlist(modelo.1[2:dim(modelo.1)[1],]),
                   ncol = dim(modelo.1)[2])
  ds.modelo.1 <- (ds.lag - ds.nolag)/ds.nolag
  colnames(ds.modelo.1) <- names(modelo.1)
  
  I <- regresion(datos = ds.modelo.1,
                  dependiente = 2,
                  independiente = 1,
                  nombre.regresion = nombres[j]) 
  if (j == 1) {
    reg.1 <- I
    j = j+1
    next
  }
  reg.1 <- rbind(reg.1, I)
  j = j + 1
}

#knitr::kable(reg.1, caption = 'Modelo 1')
```

Table: Modelo 1

|              | alpha| Tasa objetivo|     R|
|:-------------|-----:|-------------:|-----:|
|CETES 28 días | 0.000|        0.923*| 0.602|
|s.e           | 0.002|         0.061|      |
|CETES 1 año   | 0.001|        0.853*| 0.423|
|s.e           | 0.003|         0.082|      |
|Bonos 3 años  | 0.002|        0.410*| 0.071|
|s.e           | 0.004|         0.122|      |
|Bonos 5 años  | 0.002|        0.382*| 0.050|
|s.e           | 0.005|         0.143|      |
|Bonos 10 años | 0.001|         0.189| 0.015|
|s.e           | 0.007|         0.151|      |

$^*$ Significativo al 99%

Notar que el coeficiente es decreciente en el tiempo, así como que la tasa objetivo explica cada vez menos varianza del movimiento en la tasa de los instrumentos a mayor plazo. Notar que los Cetes a 28 días se mueven casí igual que la tasa de referencia, también los CETES a un año se mueve de manera muy similar. 


**(d) Interprete sus resultados a la luz de lo obtenido por Cook y Hahn para el caso de Estados Unidos.**

Obtenemos los mismos resultados cualitativos que los obtenido por Cook y Hahn. Nosotros, como Cook y Hahn, no diferenciamos los movimientos de la tasa de interés entre anticipados y no anticipados, lo anterior implica que el efecto que estimamos está subestimado cuando los cambio no son anticipados. En efecto, notar que el movimiento de Bonos a 10 años no rechaza la hipótesis nula, esto puede deberse a que no se diferenció entre cambios anticipados y no anticipados mas que no existe efecto en los bonos de 10 años a un cambio en la tasa de referencia. Los resultados son como los presentados en la literatura por Cook y Hahn.

**4. Estudie la velocidad del dinero en México siguiendo estos pasos: [2 horas, 1.5 puntos cada inciso]. Por favor documente su trabajo para que se pueda replicar.**




**(a) Obtenga datos de la cantidad de dinero de distintos tipos M0, M1, M2, M3, M4 en México y grafíquelos (en logaritmos), a frecuencia trimestral.**

Se utilizaron las siguientes series del SIE de Banxico. Se definió como M0 los billetes y monedas en poder del público. 

```{r, echo=FALSE}
Agregado <- c('Agregados Monetarios, M1, Billetes y monedas en poder del público', 
          'M1', 'M2', 'M3', 'M4')
Serie <- c('SF311409', 'SF311408', 'SF311418', 
           'SF311433','SF311438')
tipificacion <- data.frame(Agregado, Serie)
knitr::kable(tipificacion, caption = 'Agregados monetarios')
```

```{r, echo=FALSE}
# Abrir sesión en API banxico
tkn <- "8bd93af99a69ac4062f645fd43e0b517c5c88bb17750149a9fce21e47f8264af"
siebanxicor::setToken(tkn)
series <- siebanxicor::getSeriesData(Serie, '2000-01-01','2022-03-01')
j = 1
for (i in match(names(series),Serie)) {
  a <- data.frame(series[[j]])
  a[,1] <- format(a[,1], '%m-%Y')
  if (j == 1) {
    ds <- a
    colnames(ds) <- c('date' , Agregado[i])
    j = j + 1
    next
  }
  ds <- dplyr::full_join(ds, a, by = 'date')
  j = j + 1
  colnames(ds)[j] <- Agregado[i]
}
```

```{r, echo=FALSE}
ds <- dplyr::select(ds, c('date', all_of(Agregado)))
```

```{r, echo=FALSE}
ds[,1] <- as.Date(paste(rep('01-',dim(ds)[1]), 
                           as.data.frame(ds)[,1], sep = ''), 
                     '%d-%m-%Y')
ds <- dplyr::arrange(ds, date)
names(ds)[2] <- 'M0'
ds.log <- ds
nombres <- rep(names(ds.log)[2:dim(ds.log)[2]],each = dim(ds.log)[1])
fecha <- rep(dplyr::pull(ds.log, date), (dim(ds.log)[2]-1))
log.monetario <- c()
for (i in 2:dim(ds)[2]) {
  ds.log[i] <- log(ds.log[i])
  log.monetario <- c(log.monetario, dplyr::pull(ds.log, i))
}
knitr::kable(tail(ds.log), caption = 'Agregados monetarios')
```

```{r, echo=FALSE}
ds.plot <- data.frame(list(Fecha = fecha, Agregado = nombres, Log = log.monetario))

ggplot2::ggplot(data = ds.plot, ggplot2::aes(x = Fecha, y = Log, color = Agregado)) + 
  ggplot2::geom_line() + 
  ggplot2::labs(title = 'Agregados monetarios', 
                x = 'Año', y = 'Logaritmo',
                subtitle = 'Logaritmos de valor nominal',
                caption = 'Elaboración propia con datos de la SIE')
```

**(b) Obtenga el PIB nominal, y calcule la “cantidad real de dinero” M0,M1, M2,M3,M4 en México y grafique las tasas de crecimiento de los distintos tipos de dinero, todo a frecuencia trimestral.**

Para obtener la cantidad real de dinero se utilizó la ecuación cuantitativa del dinero desarrollada por Milton Friedman.

$$
P = \frac{Y_{\text{nominal}}}{Y_{real}} ; \hspace{2cm} \text{ Saldos Reales := }\frac{M}{P}
$$
Se utilizaron las series 494098 y 494782 del PIB real y nominal obtenidas del INEGI. Se presentan las gráficas.

```{r, echo=FALSE}
# Generar el coeficiente P
tkn <- '09dae22b-d57a-53f7-48e6-a83c20ccb313'
Y_real <- inegiR::inegi_series(token = tkn, series_id = '494098')
Y_nominal <- inegiR::inegi_series(token = tkn, series_id = '494782')
Y <- dplyr::inner_join(Y_real, Y_nominal, by = 'date', 
                       suffix = c('.real', '.nominal'))
P <-  dplyr::select(
    dplyr::mutate(
      dplyr::select(Y, date, values.real, values.nominal),
    P = values.nominal / values.real),
  date, P)
```

```{r, echo=FALSE}
# Generar agregados trimestrales
n <- ceiling((dim(ds)[1]-1)/4)
years <- c(2000,rep(c(2001:(ceiling(n/3)+2000)), each = 12))
cuenta <- c('10-01', 
            rep(c('01-01','04-01', '07-01', '10-01'),
                each = 3, length(years)/12))
trimestre <- paste(years, cuenta, sep = '-')[1:(n*4)]
ds.trimestre <- dplyr::ungroup(
  dplyr::summarise(
    dplyr::group_by(
      dplyr::mutate(ds, date = as.Date(trimestre)), 
    date),
  M0 = mean(M0),
  M1 = mean(M1),
  M2 = mean(M2),
  M3 = mean(M3),
  M4 = mean(M4))
)
```

```{r, echo=FALSE}
# Calcular crecimientos reales
ds.crec <- dplyr::select(
    dplyr::mutate(
      dplyr::arrange(
        dplyr::inner_join(P, ds.trimestre, by = 'date'),
      date),
    M0 = c(NA, diff(log(M0 / P))),
    M1 = c(NA, diff(log(M1 / P))),
    M2 = c(NA, diff(log(M2 / P))),
    M3 = c(NA, diff(log(M3 / P))),
    M4 = c(NA, diff(log(M4 / P)))),
  date, M0, M1, M2, M3, M4
)[4:dim(ds.trimestre)[1],]
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Generar las gráficas
plot.1 <- ggplot2::ggplot(ds.crec, 
                ggplot2::aes(x = date, y = M0)) +
        ggplot2::geom_line() +
        ggplot2::labs(
        title = 'Saldos monetarios reales M0.',
        subtitle = 'Crecimientos calculados con logaritmos.',
        x = 'Año',
        y = 'Crecimientos',
        caption = 'Elabración propia con datos del SIE Banxico e INEGI.')
plot.2 <- ggplot2::ggplot(ds.crec, 
                ggplot2::aes(x = date, y = M1)) +
        ggplot2::geom_line() +
        ggplot2::labs(
        title = 'Saldos monetarios reales M1.',
        subtitle = 'Crecimientos calculados con logaritmos.',
        x = 'Año',
        y = 'Crecimientos',
        caption = 'Elabración propia con datos del SIE Banxico e INEGI.')
plot.3 <- ggplot2::ggplot(ds.crec, 
                ggplot2::aes(x = date, y = M2)) +
        ggplot2::geom_line() +
        ggplot2::labs(
        title = 'Saldos monetarios reales M2.',
        subtitle = 'Crecimientos calculados con logaritmos.',
        x = 'Año',
        y = 'Crecimientos',
        caption = 'Elabración propia con datos del SIE Banxico e INEGI.')
plot.4 <- ggplot2::ggplot(ds.crec, 
                ggplot2::aes(x = date, y = M3)) +
        ggplot2::geom_line() +
        ggplot2::labs(
        title = 'Saldos monetarios reales M3.',
        subtitle = 'Crecimientos calculados con logaritmos.',
        x = 'Año',
        y = 'Crecimientos',
        caption = 'Elabración propia con datos del SIE Banxico e INEGI.')
plot.5 <- ggplot2::ggplot(ds.crec, 
                ggplot2::aes(x = date, y = M4)) +
        ggplot2::geom_line() +
        ggplot2::labs(
        title = 'Saldos monetarios reales M4.',
        subtitle = 'Crecimientos calculados con logaritmos.',
        x = 'Año',
        y = 'Crecimientos',
        caption = 'Elabración propia con datos del SIE Banxico e INEGI.')
plot.1
plot.2
plot.3
plot.4
plot.5
```

**(c) Produzca una tabla de estadísticas descriptivas de las tasas de crecimiento de las distintas formas de dinero real, incluyendo medias y varianzas, para todo el periodo para el que tenga datos de cada variable.**

Se presentan las tablas de estadísticas descriptivas.

```{r, echo=FALSE}
# Estadísticas descriptivas
resumen <- summary(ds.crec)
varianza <- var(ds.crec[,-1], na.rm = T)
#knitr::kable(summary(ds.crec))
```

Table: Estadísticas descriptivas I

|     date          |      M0          |      M1          |      M2          |
|:------------------|:-----------------|:-----------------|:-----------------|
|Min.   :2001-07-01 |Min.   :-0.037718 |Min.   :-0.033178 |Min.   :-0.032014 |
|1st Qu.:2006-07-24 |1st Qu.:-0.003209 |1st Qu.:-0.002392 |1st Qu.:-0.002314 |
|Median :2011-08-16 |Median : 0.008825 |Median : 0.008280 |Median : 0.009112 |
|Mean   :2011-08-16 |Mean   : 0.019092 |Mean   : 0.017767 |Mean   : 0.009542 |
|3rd Qu.:2016-09-08 |3rd Qu.: 0.038968 |3rd Qu.: 0.036906 |3rd Qu.: 0.020854 |
|Max.   :2021-10-01 |Max.   : 0.125678 |Max.   : 0.119491 |Max.   : 0.082554 |
|                   |Var    : 0.001094 |Var    : 0.001003 |Var    : 0.000417 |

Table: Estadísticas descriptivas II

|     date          |      M3          |      M4           |
|:------------------|:-----------------|:------------------|
|Min.   :2001-07-01 |Min.   :-0.034501 |Min.   :-0.0311920 |
|1st Qu.:2006-07-24 |1st Qu.:-0.001858 |1st Qu.:-0.0008376 |
|Median :2011-08-16 |Median : 0.012398 |Median : 0.0132841 |
|Mean   :2011-08-16 |Mean   : 0.010440 |Mean   : 0.0118777 |
|3rd Qu.:2016-09-08 |3rd Qu.: 0.020040 |3rd Qu.: 0.0274521 |
|Max.   :2021-10-01 |Max.   : 0.077441 |Max.   : 0.0548779 |
|                   |Var    : 0.000391 |Var    : 0.0004113 |

Notar que el crecimiento de la media, la varianza y cuartiles va a aumentando conforme se van sumando los agregados algo que esperamos por la construcción de los indicadores. 


**(d) Explique en qué medida el dinero parece comportarse o no de acuerdo a la teoría económica, considerando la demanda de dinero como una función de la actividad económica, los precios y la tasa de interés.**

Utilizaremos la siguiente regresión con dos rezagos para verificar si los saldos reales se comportan conforme a los esperado.

$$
\Delta \frac{\text{M}_{t,i \epsilon\{0,1,2,3,4\}}}{\text{P}_t} = \alpha + \beta_1\Delta \text{Y}_{t-2,real} + \beta_2 \Delta \text{tasa}_{t-2, real}
$$

Esperamos que $\beta_1 > 0$ ; $\beta_2 < 0$ y que sean significativos para que los agregados monetarios tengan la dirección de la teoría económica. 

```{r, echo=FALSE}
# Y real
Y_real.crec <- dplyr::select(
  dplyr::mutate(
    dplyr::arrange(
      dplyr::select(Y_nominal, date, values),
    date),
  Y.crec = c(NA,diff(log(values)))),
date, Y.crec
)
```

```{r, echo=FALSE}
Serie <- c('SF43936')
Tasa <- 'CETES 28'
```

Se presenta parte del conjunto de datos que se construyó.

```{r, echo=FALSE, message=FALSE}
# Abrir sesión en API banxico
tkn <- "8bd93af99a69ac4062f645fd43e0b517c5c88bb17750149a9fce21e47f8264af"
siebanxicor::setToken(tkn)
series <- siebanxicor::getSeriesData(Serie, '2000-07-01','2022-03-01')
j = 1
for (i in match(names(series),Serie)) {
  a <- data.frame(series[[j]])
  a[,1] <- format(a[,1], '%m-%Y')
  a <- dplyr::ungroup(
    dplyr::summarise(
      dplyr::group_by(a,date),
      tasa = mean(value, na.rm =T)
    )
  )
  if (j == 1) {
    ds <- a
    colnames(ds) <- c('date' , Tasa[i])
    j = j + 1
    next
  }
  ds <- dplyr::full_join(ds, a, by = 'date')
  j = j + 1
  colnames(ds)[j] <- Tasa[i]
}
ds <- dplyr::select(ds, c('date', Tasa))
ds[,1] <- as.Date(paste(rep('01-',dim(ds)[1]), 
                           as.data.frame(ds)[,1], sep = ''), 
                     '%d-%m-%Y')
ds <- dplyr::arrange(ds, date)
objetivo <- ds

#summary(ds)
#var(ds, na.rm = T)
```


```{r, echo=FALSE}
# Tasa objetivo
empieza <- as.character(objetivo$date)[1]
termina <- as.character(objetivo$date)[dim(objetivo)[1]]
inicio <- stringr::str_sub(empieza, 1, 4)
fin <- stringr::str_sub(termina, 1, 4)
anual <- paste(rep(inicio:fin, each = 12), 
                   c(paste(0, 1:9, sep = ''), 10:12), 
                   '01', sep = '-')
trimestre <- paste(rep(inicio:fin, each = 12), 
                   rep(c('01', '04', '07', '10'), each = 3), 
                   '01', sep = '-')[match(empieza, anual):match(termina, anual)]
objetivo.crec <- dplyr::select(
  dplyr::mutate(
    dplyr::ungroup(
      dplyr::summarise(
        dplyr::group_by(
          dplyr::mutate(objetivo, date = as.Date(trimestre)),
        date),
      tasa = mean(`CETES 28`))),
    tasa = c(NA,diff(log(tasa)))),
  date, tasa
)
```

```{r, echo=FALSE}
ds.reg <- tidyr::drop_na(
  dplyr::select(
  dplyr::mutate(
  dplyr::inner_join(
  dplyr::inner_join(ds.crec, Y_real.crec, by = 'date'),
  objetivo.crec, by = 'date'),
  Y.crec = dplyr::lead(Y.crec,2),
  tasa = dplyr::lead(tasa,2)),
  M0:tasa)
)

nombres <- c('M0', 'M1', 'M2', 'M3', 'M4')
for (i in 1:5) {
  reg.2 <- regresion(datos = ds.reg,
                     dependiente = i, 
                     independiente = c(6,7), 
                     nombre.regresion = nombres[i])
  if (i == 1) {
    regs <- reg.2
    next
  }
  regs <- rbind(regs, reg.2)
}

#knitr::kable(regs)
```

Table: Regresión demanda de dinero

|    | alpha| Y.crec|   tasa|     R|
|:---|-----:|------:|------:|-----:|
|M0  | 0.014|  0.250*| -0.088*| 0.153|
|s.e | 0.004|  0.084|  0.034|   |
|M1  | 0.013|  0.255*| -0.075*| 0.152|
|s.e | 0.004|  0.081|  0.033|   |
|M2  | 0.007|  0.152*| -0.064*| 0.176|
|s.e | 0.002|  0.051|  0.021|   |
|M3  | 0.008|  0.131*| -0.065*| 0.166|
|s.e | 0.002|  0.050|  0.020|   |
|M4  | 0.010|  0.110*| -0.067*| 0.149|
|s.e | 0.002|  0.052|  0.021|   |

$^*$Significativo al 95% (t $\geq$ 1.98)

Los estimadores tienen la dirección esperada, así mismo son significativos al 95%. Notemos como el efecto disminuye mientras se suman los agregados monetarios. Los saldos reales se comportan conforme la teoría. 
